<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Gamedev Canvas Workshop</title>
        <style>
            * {
                padding: 0; 
                margin: 0; 
            }

            canvas {
                background: #eee;
                display: block;
                margin: 0 auto;
            }
        </style>
    </head>

    <body>
        <canvas id="myCanvas" width="500" height="350"></canvas>
        <script>
            //menyimpan nilai data sementara
            var canvas = document.getElementById('myCanvas');
            var context = canvas.getContext('2d');

            var speed = 10; 
            var gameSpeed = 1; 

            var me = {
                x: canvas.width / 2 - 5,
                y: canvas.height / 2 - 5,
                width: 10,
                height: 10 
            }

            var bullets = [];
            var wallLength = 200;
            var walls = {
                //ukuran dinding sebelah kiri
                'left': {
                    x: 10,
                    y: canvas.height / 2 - wallLength / 2,
                    width: 10,
                    height: wallLength, 
                    'pos': 'left'
                },
                //ukuran dinding sebelah kanan
                'right': {
                    x: canvas.width - 20,
                    y: canvas.height / 2 - wallLength / 2,
                    width: 10,
                    height: wallLength,
                    'pos': 'right'  
                },
                //ukuran dinding sebelah atas
                'top': {
                    x: canvas.width / 2 - wallLength,
                    y: 10,
                    width: wallLength * 2,
                    height: 10,
                    'pos': 'top' 
                },
                //ukuran dinding bagian bawah
                'bottom': {
                    x: canvas.width / 2 - wallLength, 
                    y: canvas.height - 20,
                    width: wallLength * 2,
                    height: 10, 
                    'pos': 'bottom' 
                },
            };

            //menyimpan nilai data sementara
            var gravity = 0.2;
            var bounce = 4; 
            var distance = 70;
            var dir = ''; 

            //menekan tombol pada keyboard
            document.onkeyup = function (e) {
                if (!e) {
                    e = window.e;
                }
                var code = e.keyCode;
                if (e.charCode && codee == 0) {
                    code = e.charCode;
                }

                switch (code) {
                    //jika menekan tombol arah kiri
                    case 37:
                        if (dir != 'left')
                            dir = 'left';
                        bullets.push({
                            x: me.x,
                            y: me.y,
                            width: 10,
                            height: 10,
                            dir: dir
                        });
                        break;

                    //jika menekan tombol arah bawah
                    case 40:
                        if (dir != 'down')
                            dir = 'down';
                        bullets.push({
                            x: me.x,
                            y: me.y,
                            width: 10,
                            height: 10,
                            dir: dir
                        });
                        break;
                    
                    //jika menekan tombol arah kanan
                    case 39:
                        if (dir != 'right')
                            dir = 'right';
                        bullets.push({
                            x: me.x,
                            y: me.y,
                            width: 10,
                            height: 10,
                            dir: dir    
                        });
                        break;

                    //jika menekan tombol arah atas
                    case 38:
                        if (dir != 'up')
                            dir = 'up';
                        bullets.push({
                            x: me.x,
                            y: me.y,
                            width: 10,
                            height: 10,
                            dir: dir
                         });
                        break;
                }



            }

            //menyimpan nilai data sementara
            var wallSpeed = 0.2;
            var walletBackward = 20;
            var score = 0;

            //fungsi dinding rintangan
            function makeWalls() {
                for (var index in walls) {
                    var wall = walls[index]; 
                    context.beginPath();
                    context.rect (wall.x, wall.y, wall.width, wall.height); 
                    context.fillStyle = "blue"; //dinding berwarna biru
                    context.fill(); 
                    context.closePath(); 
                    //jika dinding sebelah kiri terkena peluru
                    if (wall.pos == 'left') {
                        wall.x += wallSpeed; 

                        //jika dinding sebelah kiri mengenai player
                        if ((wall.x + wall.width) >= me.x) {
                            loose(); //kalah
                        }
                    }

                    //jika dinding sebelah kanan terkena peluru
                    if (wall.pos == 'right') {
                        wall.x -= wallSpeed;

                        //jika dinding sebelah kanan mengenai player
                        if ((wall.x + wall.width) <= me.x) {
                            loose(); //kalah
                        }
                    }

                    //jika dinding sebelah atas terkena peluru
                    if (wall.pos == 'top') {
                        wall.y += wallSpeed;

                        //jika dinding sebelah atas mengenai player
                        if ((wall.y + wall.height) >= me.y) {
                            loose(); //kalah
                        }
                    }
                    
                    //jika dinding sebelah bawah terkena peluru
                    if (wall.pos == 'bottom') {
                        wall.y -= wallSpeed; 

                        //jika dinding sebelah bawah mengenai player
                        if ((wall.y + wall.height) <= me.y) {
                            loose (); //kalah
                        }
                    }

                    // console.log (walls [wall]);
                }


            }


            //fungsi ketika kalah akan mendapatkan skor
            function loose() {
                alert ('You Lose! score : ' + score); 
            }
            var collid = false;

            //fungsi peluru
            function makeBullet() {
                for (bullet of bullets) {
                    context.beginPath(); 
                    context.rect (bullet.x, bullet.y, bullet.width, bullet.height); 
                    context.fillStyle = "red"; 
                    context.fill(); 
                    context.closePath(); 

                    //jika menembak peluru ke arah kiri
                    if (bullet.dir == 'left') {
                        bullet.x -= 10; 
                    }

                    //jika menembak peluru ke arah kanan
                    if (bullet.dir == 'right') {
                        bullet.x += 10;
                    }

                    //jika menembak peluru ke arah atas
                    if (bullet.dir == 'up') {
                        bullet.y -= 10;
                    }

                    //jika menembak peluru ke arah bawah
                    if (bullet.dir == 'bottom') {
                        bullet.y += 10;
                    }

                    //jika peluru terkena dinding terlebih dahulu
                    if (bullet.x >= canvas.width || bullet.x <= 0 || bullet.y >= canvas.height || bullet.y <= 0) {
                        bullets.splice (bullets.indexOf(bullet), 1); 
                    }

                    //jika peluru terkena dinding sebelah kanan
                    if (bullet.dir == 'right') {
                        if (bullet.x >= walls['right'].x) {
                            walls['right'].x = walls['right'].x + walletBackward;  //dinding sebelah kanan akan mundur
                            collid = true; 
                        }

                    }

                    //jika peluru terkena dinding sebelah atas
                    if (bullet.dir == 'up') {
                        if (bullet.y <= walls['top'].y) {
                            walls ['top'].y = walls['top'].y - walletBackward; //dinding sebelah atas akan mundur
                            collid = true; 
                        }

                    }

                    //jika peluru terkenan dinding sebelah bawah
                    if (bullet.dir == 'down') {
                        if (bullet.y >= walls ['bottom'].y) {
                            walls ['bottom'] .y = walls ['bottom'].y + walletBackward; //dinding sebelah bawah akan mundur
                            collid = true; 
                        }

                    }

                    //jika peluru terkenan dinding sebelah kiri 
                    if (bullet.dir == 'left') {
                        if (bullet.x <= walls['left'].x) {
                            walls ['left'].x = walls['left'].x - walletBackward; //dinding sebelah kiri akan mundur
                            collid = true;
                        }

                    }

                    //jika dinding terkena peluru
                    if (collid) {
                        bullets.splice (bullets.indexOf(bullet), 1); 
                        collid = false;
                        score++; 
                    }



                }
            }

            //fungsi ketika sudah menembak peluru sekali
            function removeBullet (index) {
                bullets.splice (index, 1);
            }

            //fungsi player
            function makeMe () {
                context.beginPath(); 
                context.rect (me.x, me.y, me.width, me.height); 
                context.fillStyle = "green"; //player berwarna hijau
                context.fill(); 
                context.closePath(); 

            }

            //fungsi rintangan dinding
            function rnd (min, max) {
                var r = Math.round (Math.random() * (max - min) + min); 
                return (r - r % speed);
            }
            var wallPoses = ['left', 'right', 'top', 'bottom']; 
            var frame = 0; 
            //fungsi jika berhasil menembak dinding
            (function loop() {
                requestAnimationFrame (function () {
                    context.clearRect(0, 0, canvas.width, canvas.height); 
                    makeMe(); 
                    makeBullet();
                    makeWalls();
                    //jika peluru mengenai dinding
                    if (score % 50 == 0) {
                        walletBackward -= 1;
                        wallSpeed += 0.1; 
                        score += 1; 
                        console.log (score); 
                        console.log (wallSpeed); 
                        console.log (walletBackward);

                    }

                    if (frame % gameSpeed == 0) {
                        frame++;
                    }
                    loop();
                })
            }) ();
        </script>
    </body>
</html>